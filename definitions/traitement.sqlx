WITH transaction_counts AS (
  SELECT id_transaction, id as client, COUNT(*) as transaction_count
  FROM `dataform.transactions`
  GROUP BY id, id_transaction
)

-- Cat√©gorisation des clients et insertion dans la table "segment".
INSERT INTO ${ref("segment")} (client, category)
SELECT client, CASE WHEN transaction_count = 1 THEN 'XL' ELSE 'M' END as category
FROM transaction_counts

